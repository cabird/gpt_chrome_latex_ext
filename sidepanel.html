<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>LaTeX Assistant</title>
  <link rel="stylesheet" href="sidepanel.css">
  <script src="o200k_base.js"></script>
</head>
<body>
  <div class="container">
    <h2>LaTeX Assistant</h2>
    
    <div class="settings-section">
      <div class="settings-header">
        <h3>Settings</h3>
        <button id="toggleSettings" class="toggle-btn">‚ñº</button>
      </div>
      <div id="settingsContent" class="settings-content">
      <div class="input-group">
        <label for="modelConfig">Model Configuration:</label>
        <div class="config-selector">
          <select id="modelConfig">
            <option value="">Select configuration...</option>
            <option value="__new__">+ New Configuration</option>
          </select>
          <button id="deleteConfig" class="icon-btn delete-config-btn" title="Delete configuration" style="display: none;">üóëÔ∏è</button>
        </div>
      </div>
      <div class="input-group">
        <label for="configName">Configuration Name:</label>
        <div class="config-name-row">
          <input type="text" id="configName" placeholder="e.g., GPT-4 Production">
          <button id="saveConfig">Save</button>
        </div>
      </div>
      <div class="input-group">
        <label for="provider">Provider:</label>
        <select id="provider">
          <option value="azure">Azure OpenAI</option>
          <option value="openai">OpenAI</option>
        </select>
      </div>
      <div class="input-group">
        <label for="apiKey">API Key:</label>
        <input type="password" id="apiKey" placeholder="Enter your API key">
      </div>
      <div class="input-group azure-only">
        <label for="endpoint">Azure Endpoint:</label>
        <input type="text" id="endpoint" placeholder="https://your-resource.openai.azure.com">
      </div>
      <div class="input-group azure-only">
        <label for="deployment">Deployment Name:</label>
        <input type="text" id="deployment" placeholder="your-deployment-name">
      </div>
      <div class="input-group openai-only" style="display: none;">
        <label for="model">Model:</label>
        <select id="model">
          <option value="gpt-5">GPT-5</option>
          <option value="gpt-5-mini">GPT-5 Mini</option>
          <option value="gpt-4-turbo-preview">GPT-4 Turbo</option>
          <option value="gpt-4">GPT-4</option>
          <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
          <option value="gpt-4o">GPT-4o</option>
          <option value="gpt-4o-mini">GPT-4o Mini</option>
        </select>
      </div>
      <div class="input-group">
        <label for="promptTemplate">Prompt Template:</label>
        <textarea id="promptTemplate" rows="5" placeholder="I'm working on LaTeX text. Here is the text I've selected:&#10;&#10;{{LATEX_TEXT}}&#10;&#10;My instruction: {{INSTRUCTIONS}}"></textarea>
        <small class="help-text">Use {{LATEX_TEXT}} for selected text, {{INSTRUCTIONS}} for your instructions, and {{CONTEXT}} for additional context</small>
      </div>
      </div>
    </div>

    <div class="divider"></div>

    <div class="assistant-section">
      <div class="context-container">
        <div class="context-header">
          <h3>Context (Optional)</h3>
          <div class="context-controls">
            <button id="clearContext" class="icon-btn" title="Clear context">üóëÔ∏è</button>
            <button id="toggleContext" class="toggle-btn">‚ñº</button>
          </div>
        </div>
        <div id="contextContent" class="context-content">
          <div class="context-management">
            <div class="context-save-row">
              <input type="text" id="contextName" placeholder="Enter context name..." />
              <button id="saveContext" class="small-btn">Save</button>
            </div>
            <div class="context-load-row">
              <select id="savedContexts">
                <option value="">Select saved context...</option>
              </select>
              <button id="deleteContext" class="small-btn delete-btn">Delete</button>
            </div>
          </div>
          <textarea id="contextText" rows="6" placeholder="Paste additional context here (e.g., the full paper)"></textarea>
          <div class="token-count" id="contextTokenCount">0 tokens</div>
        </div>
      </div>

      <div class="selected-text-container">
        <h3>Selected Text</h3>
        <div id="selectedText" class="text-display">
          <p class="placeholder">Highlight text in the page to see it here</p>
        </div>
        <div class="token-count" id="selectedTokenCount">0 tokens</div>
      </div>

      <div class="input-group">
        <label for="userPrompt">Your instruction:</label>
        <textarea id="userPrompt" rows="3" placeholder="e.g., Can you improve this sentence?"></textarea>
      </div>

      <div class="token-count total-tokens" id="totalTokenCount">Total: 0 tokens</div>
      <button id="submitBtn" disabled>
        <span id="submitBtnText">Process Text</span>
        <span id="submitBtnSpinner" class="spinner" style="display: none;"></span>
      </button>

      <div class="response-container">
        <h3>AI Response</h3>
        <div id="responseText" class="text-display">
          <p class="placeholder">Response will appear here</p>
        </div>
        <div id="loadingIndicator" class="loading-indicator" style="display: none;">
          <div class="loading-spinner"></div>
          <span>Processing your request...</span>
        </div>
        <div id="tokenUsage" class="token-usage" style="display: none;">
          <span class="usage-item">Prompt: <strong id="promptTokens">0</strong> tokens (<span id="newTokens">0</span> new, <span id="cachedTokens">0</span> cached)</span>
          <span class="usage-separator">‚Ä¢</span>
          <span class="usage-item">Completion: <strong id="completionTokens">0</strong> tokens</span>
        </div>
        <button id="copyBtn" style="display: none;">Copy to Clipboard</button>
      </div>
    </div>

    <div id="statusMessage" class="status"></div>
  </div>

  <script src="sidepanel.js"></script>
</body>
</html>